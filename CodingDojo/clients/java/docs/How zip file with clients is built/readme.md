Как упаковываются архив с файлами клиентов для разных языков?
--------------
Вот наш репозиторий новый, он так же subrepo подключен к основному.

![img.png](img.png)

Его структура такая:

![img_1.png](img_1.png)

- client - пакет содержит все что касается клиентского кода.
- services - содержит все, что пришлось забрать из Engine сюда, потому как client зависит от этого стафа.
- games - внутри купа игрушек по пакетам побиты.

![img_2.png](img_2.png)

В каждой чаще всего встречаются
- Board - с методами-дополнениями для борды;
- Element (который теперь тут сторится, раньше числился в игрушке как Elements);
- и YourSolver для написания кода играющего (реализовать с 1 солвером для всех игр не получилось).

Так же в тестах для каждой игрушки:
- заготовка под тест для солвера;
- и тест для борды.

![img_3.png](img_3.png)

Иногда для некоторых игрушек, структура чуть меняется.

![img_4.png](img_4.png)

Но суть остается та же. Тут три роли: борда, элементс мапа и солвер игрока
в корне я оставил mvnw навсякий, может надо будет билдить игроку.

![img_5.png](img_5.png)

Чтобы участник не ставил maven на свою машину.

Если зайти в pom.xml то там есть два момента.

![img_6.png](img_6.png)

Так мы подчистим файл с сырцами.

![img_7.png](img_7.png)

А так мы его создаем во время сборки.

Вот константы как определены.

![img_8.png](img_8.png)

Zip файл расположится в инсталируемом в .m2 папку jar этого проекта (при mvn clean install), ляжет zip в папке /resources/user/java-client.zip, а внутри будут все сырцы этого проекта

![img_9.png](img_9.png)

Внутри сырцы java client.

![img_10.png](img_10.png)

Эти файлы на момент написания мануала находятся в папке files этого мануала.

Дальше немного Моагии.

Каждая игрушка сама должна позаботиться о своих клиентах и созрать zip с ними. Раньше это делалось во время билда jar игры подобным образом ant'ом внутри maven'а из сырцов.

![img_11.png](img_11.png)

Все остается (пока не мигрируем все клиенты) как и раньше с одним лишь исключением - теперь java сырцы находятся в /resources/user/java-client.zip стороннего с точки зрения игры jar

А потому будем колдовать.

В games/pom.xml есть плагин.

![img_12.png](img_12.png)

Он распакует из java-client.jar дипенденси (которая явно в плагине указана) тот /resources/user/java-client.zip в папочку target/java-client.

![img_17.png](img_17.png)

А после на другой фазе отработает ant.

![img_13.png](img_13.png)

Вначале он распакуте zip в той же папке, чтобы добраться до сырцов java-client.

![img_14.png](img_14.png)

Потом скопирует в <game>-servers.zip (тот что уже сервер отдавать будет) только те сырцы, что нужны (пакеты services, client, games/<game> со всем что надо для запуска проекта) - это java часть. Другие игры не включатся, только games/<game>.

![img_15.png](img_15.png)

Следом отработает копировальщик сырцов других языков из сырцов игрового проекта.

![img_16.png](img_16.png)

Вот этих (все кроме java).

![img_18.png](img_18.png)

Дальше скопируется в zip logback.xml пустой для отключени вывода треша дебагового в клиенте (это старая штука).

![img_19.png](img_19.png)

И наконец перепакованный <game>-servers.zip ляжет в нужное ему место. 

![img_20.png](img_20.png)

Тут его будет искать codenjoy server когда будет запрос этого зипа как ресурса. Сервер ищет во всех jar дипенденсях с помощью этого малого.

![img_21.png](img_21.png)

Это временное решение, пока не перенесем все клиенты каждый в свой репо. Тогда можно будет переписать скрин отдачи клиентов и захардкодить там ссылки на github по каждому языку. А весь этот код выпилить нафиг, вздохнув с облегчением ).

